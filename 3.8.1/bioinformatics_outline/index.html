<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="author" content="CIDR" /><link rel="canonical" href="https://gstt-cidr.github.io/network_hub/3.8.1/bioinformatics_outline/" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>Overview - CIDR Metagenomics Hub</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../assets/_mkdocstrings.css" rel="stylesheet" />
        <link href="../assets/js/jquery-jvectormap.css" rel="stylesheet" />
        <link href="https://cdn.datatables.net/2.2.2/css/dataTables.dataTables.min.css" rel="stylesheet" />
        <link href="../css/version-select.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Overview";
        var mkdocs_page_input_path = "bioinformatics_outline.md";
        var mkdocs_page_url = "/network_hub/3.8.1/bioinformatics_outline/";
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
 <link href="../assets/stylesheets/glightbox.min.css" rel="stylesheet"/><style>
    html.glightbox-open { overflow: initial; height: 100%; }
    .gslide-title { margin-top: 0px; user-select: text; }
    .gslide-desc { color: #666; user-select: text; }
    .gslide-image img { background: white; }</style> <script src="../assets/javascripts/glightbox.min.js"></script></head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> CIDR Metagenomics Hub
        </a>
        <div class="version">
          {'provider': 'mike', 'default': 'latest'}
        </div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption"><span class="caption-text">Introduction</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="..">Clinical metagenomics</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Lab Resources</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../panmetagenomics_protocol/">Lab protocols</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Bioinformatics</span></p>
              <ul class="current">
                  <li class="toctree-l1 current"><a class="reference internal current" href="./">Overview</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#introduction">Introduction</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#mscape">mSCAPE</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#technical-facets">Technical facets</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#taxonomic-classification">taxonomic classification</a>
    </li>
        </ul>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#related-code-snippets">Related code snippets</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#masking-a-fasta-database-using-bbmask">Masking a FASTA database using BBmask</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#building-a-centrifuge-index-">Building a centrifuge index -</a>
    </li>
        </ul>
    </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../bioinformatics_install/">Installation and validation</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../running_minknow/">Starting a MinKNOW experiment</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../running_metagenomics_workflow/">Running the metagenomics workflow</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../running_organism_query/">Query a classification</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../mSCAPE_integration/">Uploading to mSCAPE</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../additional_tools/">Summary report</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../alternative_deployment/">Deployment alternatives</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Analysis</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../clinical_interpretation/">Clinical evaluation SOP</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../validation_outline/">Validation outline</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">FAQ</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../faq/">Frequently asked questions</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">CIDR Metagenomics Hub</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">Bioinformatics</li>
      <li class="breadcrumb-item active">Overview</li>
    <li class="wy-breadcrumbs-aside">
          <a href="https://github.com/GSTT-CIDR/network_hub/edit/master/docs/bioinformatics_outline.md" class="icon icon-github"> Edit on GitHub</a>
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <div><h1 id="clinical-metagenomics-bioinformatics-381">Clinical metagenomics bioinformatics 3.8.1</h1>
<div class="admonition tip">
<p class="admonition-title">Recent updates</p>
<p><strong>02/07/24</strong> - Use of 'hospital number' have been changed to 'anonymised identifier'. Matagenomics and mSCAPE GUIs have been updated to reflect this. The mSCAPE Launcher's hospital number encryption function has been removed.</p>
</div>
<h2 id="introduction">Introduction</h2>
<p>The principal output of the CIDR Metagenomics workflow is a PDF report listing organisms with detectable nucleic acids (RNA/DNA) and some additional information on AMR associated sequence data. The solution packages two applications - CIDR Metagenomics Workflow and <a href="../running_organism_query/">Organism Query</a> alongside a few scripts to help manage and analyse outputs. The Metagenomics Workflow runs ontop of MinKNOW, analysing sequencing data in real time producing easily digested report. <a href="../running_organism_query/">Organism Query</a> can be used to scrutinise classifications contained within a report. It leverages the full NCBI nt and RefSeq databases producing a report similar to NCBI BLAST in ~15 minutes. The Organism Query report is designed to provide the user with appropriate information to scrutinise a significant taxonomic classification.</p>
<p><strong>The key stages of performing the bioinformatics workflow are as follow:</strong></p>
<ol>
<li><a href="../bioinformatics_install/">Install workflow</a> (only on first use).</li>
<li><a href="../running_minknow/">Start MinKNOW sequencing experiment</a>.</li>
<li><a href="../running_metagenomics_workflow/">Start the Metagenomics workflow</a>.</li>
</ol>
<p><strong>Optional:</strong></p>
<ol start="4">
<li><a href="../running_organism_query/">Query a classification</a>.</li>
<li><a href="../mSCAPE_integration/">Upload data to mSCAPE</a>.</li>
<li>Generate a summary spreadsheet.</li>
</ol>
<h3 id="mscape">mSCAPE</h3>
<p>Users can opt in to <a href="../mSCAPE_integration/">mSCAPE</a> on an per-experiment basis for an automatic upload of sequencing data to UKHSA mSCAPE. </p>
<h3 id="technical-facets">Technical facets</h3>
<p>After loading a metagenomic library on to an ONT sequencing device and launching the sequencing experiment in ONT MinKNOW the pipeline is initialised by the user through the Metagenomics Launcher graphical user interface (GUI). The software periodically ingests base called FASTQ data from the GridION <code>/data/</code> directory at set intervals - 0.5, 1, 2, 16 and 24 hours. At each interval, the pipeline performs human scrubbing, taxonomic classification, AMR detection and MLST which is then consolidated in to a PDF reports which are saved in the <code>/media/grid/metagenomics/results/</code> directory. The diagram below illustrates further details of how the pipeline works:  </p>
<p><a class="glightbox" href="../img/pipeline%20digram.drawio.svg" data-type="image" data-width="auto" data-height="auto" data-title="Diagram of the metagenomics software package" data-desc-position="bottom"><img alt="image" data-description="" data-title="Diagram of the metagenomics software package" src="../img/pipeline%20digram.drawio.svg"></a></p>
<h4 id="taxonomic-classification">taxonomic classification</h4>
<p>At its core, the pipeline leverages a taxonomic classification tool called <a href="https://ccb.jhu.edu/software/centrifuge/manual.shtml">Centrifuge</a>. There a numerous alternatives, the most common being Kraken. We chose centrifuge namely because of its smaller memory footprint and existing deployment in ONT's WIMP. Each read in the raw data is aligned against an index, and is assigned a confidence score and a taxonomy. Our index is an optimised database of curated eukrayotic, prokaryotic, and viral reference sequences formed primarily from <a href="https://en.wikipedia.org/wiki/RefSeq">NCBI RefSeq</a> and <a href="https://www.fda.gov/medical-devices/science-and-research-medical-devices/database-reference-grade-microbial-sequences-fda-argos">FDA-ARGOS</a> databases. This is provided on the SSD sent to each site.</p>
<p>The index was built from the following <a href="https://raw.githubusercontent.com/GSTT-CIDR/metagenomics_workflow/main/ref/centrifuge_db_v4.map">sequences</a> - this map file contains the accession number for each sequence in the database and the accompanying taxa ID. This file is required to assemble the Centrifuge index alongside the sequences in FASTA format. Before building the index, the sequences were masked using <a href="https://jgi.doe.gov/data-and-tools/software-tools/bbtools/bb-tools-user-guide/bbmask-guide/">BBmask</a>. This tool is applied primarily to prevent false-positive matches in highly-conserved or low-complexity regions of genomes. </p>
<h2 id="related-code-snippets">Related code snippets</h2>
<h4 id="masking-a-fasta-database-using-bbmask">Masking a FASTA database using BBmask</h4>
<pre><code>bbmask.sh in=unmasked.fasta out=masked.fasta entropy=0.7 -Xmx80g  maskrepeats=t
</code></pre>
<h4 id="building-a-centrifuge-index-">Building a centrifuge index -</h4>
<pre><code># --bmax needs tuning based on available memory.
centrifuge-build -p 10 --conversion-table accession2taxid.map --taxonomy-tree ./taxdump/nodes.dmp --name-table ./taxdump/names.dmp  masked.fasta centrifuge_index_v2 --bmax 1042177280
</code></pre></div>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../panmetagenomics_protocol/" class="btn btn-neutral float-left" title="Lab protocols"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../bioinformatics_install/" class="btn btn-neutral float-right" title="Installation and validation">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/GSTT-CIDR/network_hub" class="fa fa-github" style="color: #fcfcfc"> GitHub</a>
        </span>
    
    
      <span><a href="../panmetagenomics_protocol/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../bioinformatics_install/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
      <script src="https://cdn.datatables.net/2.2.2/js/dataTables.min.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jvectormap/2.0.5/jquery-jvectormap.js"></script>
      <script src="../assets/js/jquery-jvectormap.js"></script>
      <script src="../assets/js/jquery-mousewheel.js"></script>
      <script src="../assets/js/jvectormap.js"></script>
      <script src="../assets/js/abstract-element.js"></script>
      <script src="../assets/js/abstract-canvas-element.js"></script>
      <script src="../assets/js/abstract-shape-element.js"></script>
      <script src="../assets/js/svg-element.js"></script>
      <script src="../assets/js/svg-group-element.js"></script>
      <script src="../assets/js/svg-canvas-element.js"></script>
      <script src="../assets/js/svg-shape-element.js"></script>
      <script src="../assets/js/svg-path-element.js"></script>
      <script src="../assets/js/svg-circle-element.js"></script>
      <script src="../assets/js/svg-image-element.js"></script>
      <script src="../assets/js/svg-text-element.js"></script>
      <script src="../assets/js/vml-element.js"></script>
      <script src="../assets/js/vml-group-element.js"></script>
      <script src="../assets/js/vml-canvas-element.js"></script>
      <script src="../assets/js/vml-shape-element.js"></script>
      <script src="../assets/js/vml-path-element.js"></script>
      <script src="../assets/js/vml-circle-element.js"></script>
      <script src="../assets/js/vml-image-element.js"></script>
      <script src="../assets/js/map-object.js"></script>
      <script src="../assets/js/region.js"></script>
      <script src="../assets/js/marker.js"></script>
      <script src="../assets/js/vector-canvas.js"></script>
      <script src="../assets/js/simple-scale.js"></script>
      <script src="../assets/js/ordinal-scale.js"></script>
      <script src="../assets/js/numeric-scale.js"></script>
      <script src="../assets/js/color-scale.js"></script>
      <script src="../assets/js/legend.js"></script>
      <script src="../assets/js/data-series.js"></script>
      <script src="../assets/js/proj.js"></script>
      <script src="../assets/js/map.js"></script>
      <script src="../assets/js/uk_mill.js"></script>
      <script src="../js/version-select.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

<script>const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});</script></body>
</html>
